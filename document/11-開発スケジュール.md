# 11 - 開発スケジュール

> [[10-監視と運用]] | [[BondPoint設計書]] | Next: [[12-コストとスケーリング]]

## 📅 12週間開発計画

### 開発方針
- **MVP First**: コア機能に集中、段階的機能追加
- **週次リリース**: 毎週金曜日にStaging環境デプロイ
- **学習重視**: React Native初心者向けの段階的学習計画
- **品質重視**: テスト・レビューを並行実施

---

## 🏗️ Week 1-2: 環境構築・基盤開発

### Week 1: 開発環境構築

#### バックエンド（FastAPI）
- [x] **Day 1-2**: GCP プロジェクト作成・IAM設定
  ```bash
  # GCP プロジェクト作成
  gcloud projects create bondpoint-mvp
  gcloud config set project bondpoint-mvp

  # 必要API有効化
  gcloud services enable cloudsql.googleapis.com
  gcloud services enable run.googleapis.com
  gcloud services enable secretmanager.googleapis.com
  ```

- [x] **Day 3-4**: Cloud SQL（PostgreSQL）セットアップ
  ```bash
  # Cloud SQL インスタンス作成
  gcloud sql instances create bondpoint-db \
    --database-version=POSTGRES_15 \
    --tier=db-f1-micro \
    --region=asia-northeast1
  ```

- [x] **Day 5-7**: FastAPI プロジェクト構築
  ```python
  # プロジェクト構造
  bondpoint-backend/
  ├── app/
  │   ├── api/
  │   ├── models/
  │   ├── services/
  │   └── main.py
  ├── tests/
  ├── requirements.txt
  └── Dockerfile
  ```

#### フロントエンド（React Native）
- [x] **Day 1-3**: React Native 開発環境構築
  ```bash
  # React Native CLI インストール
  npm install -g @react-native-community/cli

  # プロジェクト作成
  npx react-native init BondPointApp --template react-native-template-typescript
  ```

- [x] **Day 4-7**: 基本依存関係インストール・設定
  ```bash
  # 必要パッケージインストール
  npm install @react-navigation/native @react-navigation/stack
  npm install react-native-maps @react-native-firebase/app
  ```

### Week 2: 基本認証システム

#### バックエンド実装
- [x] **Day 1-3**: JWT認証システム実装
  ```python
  # JWT認証クラス実装
  class JWTManager:
      def create_access_token(self, user_id: str) -> str
      def verify_token(self, token: str) -> dict
  ```

- [x] **Day 4-5**: SMS認証API実装
  ```python
  @app.post("/api/v1/auth/register")
  async def register_user(user_data: UserRegister)

  @app.post("/api/v1/auth/verify")
  async def verify_sms_code(verification: SMSVerification)
  ```

- [x] **Day 6-7**: データベーススキーマ作成
  ```sql
  -- Alembic マイグレーション
  alembic revision --autogenerate -m "Initial schema"
  alembic upgrade head
  ```

#### フロントエンド実装
- [x] **Day 1-4**: 認証画面UI作成
  ```typescript
  // 画面構成
  - LoginScreen
  - PhoneInputScreen
  - SMSVerificationScreen
  - WelcomeScreen
  ```

- [x] **Day 5-7**: 認証フロー実装
  ```typescript
  // 認証フロー
  const authFlow = () => {
    // 電話番号入力 → SMS送信 → コード確認 → ログイン
  }
  ```

---

## 🏢 Week 3-4: コア機能開発

### Week 3: ユーザー・グループ機能

#### バックエンド
- [x] **Day 1-2**: ユーザー管理API
  ```python
  @app.get("/api/v1/users/me")
  async def get_current_user()

  @app.put("/api/v1/users/profile")
  async def update_profile()
  ```

- [x] **Day 3-5**: グループ管理API
  ```python
  @app.post("/api/v1/groups")
  async def create_group()

  @app.post("/api/v1/groups/{group_id}/join")
  async def join_group()
  ```

- [x] **Day 6-7**: Cloud Storage 画像アップロード
  ```python
  @app.post("/api/v1/users/profile/image")
  async def upload_profile_image()
  ```

#### フロントエンド
- [x] **Day 1-3**: ホーム画面・ナビゲーション
  ```typescript
  // メイン画面構成
  const TabNavigator = () => (
    <Tab.Navigator>
      <Tab.Screen name="Home" component={HomeScreen} />
      <Tab.Screen name="Groups" component={GroupsScreen} />
      <Tab.Screen name="Profile" component={ProfileScreen} />
    </Tab.Navigator>
  );
  ```

- [x] **Day 4-7**: グループ作成・参加フロー
  ```typescript
  // グループ機能
  - CreateGroupScreen
  - GroupDetailScreen
  - InviteCodeScreen
  ```

### Week 4: イベント機能

#### バックエンド
- [x] **Day 1-3**: イベント管理API
  ```python
  @app.post("/api/v1/events")
  async def create_event()

  @app.get("/api/v1/events/{event_id}")
  async def get_event_details()
  ```

- [x] **Day 4-5**: 出欠確認API
  ```python
  @app.post("/api/v1/events/{event_id}/attend")
  async def update_attendance()
  ```

- [x] **Day 6-7**: Google Maps API 統合
  ```python
  @app.get("/api/v1/routes/calculate")
  async def calculate_route()
  ```

#### フロントエンド
- [x] **Day 1-4**: イベント作成・詳細画面
  ```typescript
  // イベント関連画面
  - CreateEventScreen
  - EventDetailScreen
  - AttendanceScreen
  ```

- [x] **Day 5-7**: Google Maps 統合
  ```typescript
  // マップ機能
  import MapView, { Marker } from 'react-native-maps';

  const EventMapView = () => (
    <MapView>
      <Marker coordinate={eventLocation} />
    </MapView>
  );
  ```

---

## ⭐ Week 5-6: ステータス機能（コア差別化）

### Week 5: ステータス管理API

#### バックエンド
- [x] **Day 1-3**: ステータステーブル設計・実装
  ```python
  # user_statuses テーブル
  class UserStatus(Base):
      id: UUID
      event_id: UUID
      user_id: UUID
      status_type: str
      custom_message: Optional[str]
      updated_at: datetime
  ```

- [x] **Day 4-5**: ステータス更新API
  ```python
  @app.post("/api/v1/events/{event_id}/status")
  async def update_user_status()

  @app.get("/api/v1/events/{event_id}/statuses")
  async def get_all_statuses()
  ```

- [x] **Day 6-7**: Firestore リアルタイム同期
  ```python
  async def sync_status_to_firestore(event_id, user_id, status_data):
      doc_ref = firestore.collection('events').document(event_id)
      await doc_ref.collection('statuses').document(user_id).set(status_data)
  ```

#### フロントエンド
- [x] **Day 1-4**: ステータス選択UI
  ```typescript
  // 8つのプリセットステータス
  const StatusSelector = () => (
    <View>
      {STATUS_PRESETS.map(status => (
        <TouchableOpacity key={status.key} onPress={() => updateStatus(status)}>
          <Text>{status.icon} {status.label}</Text>
        </TouchableOpacity>
      ))}
    </View>
  );
  ```

- [x] **Day 5-7**: リアルタイム同期実装
  ```typescript
  // Firestore リアルタイムリスナー
  useEffect(() => {
    const unsubscribe = firestore()
      .collection('events')
      .doc(eventId)
      .collection('statuses')
      .onSnapshot(handleStatusUpdate);

    return unsubscribe;
  }, [eventId]);
  ```

### Week 6: 位置情報・プライバシー機能

#### バックエンド
- [x] **Day 1-3**: 位置情報暗号化システム
  ```python
  class LocationEncryption:
      def encrypt_coordinates(self, lat: float, lng: float) -> tuple
      def decrypt_coordinates(self, encrypted_lat: str, encrypted_lng: str) -> tuple
  ```

- [x] **Day 4-5**: プライバシー制御API
  ```python
  @app.post("/api/v1/events/{event_id}/location/share")
  async def update_location_sharing()

  @app.get("/api/v1/events/{event_id}/locations")
  async def get_member_locations()
  ```

- [x] **Day 6-7**: 自動プライバシー制御
  ```python
  # Cloud Functions
  async def auto_disable_location_sharing():
      # イベント終了5時間後に自動OFF
  ```

#### フロントエンド
- [x] **Day 1-4**: 位置情報権限・設定UI
  ```typescript
  // 位置情報権限要求
  const requestLocationPermission = async () => {
    const granted = await PermissionsAndroid.request(
      PermissionsAndroid.PERMISSIONS.ACCESS_FINE_LOCATION
    );
    return granted === PermissionsAndroid.RESULTS.GRANTED;
  };
  ```

- [x] **Day 5-7**: リアルタイムマップ表示
  ```typescript
  // メンバー位置表示
  const MemberMap = () => (
    <MapView>
      {memberLocations.map(member => (
        <Marker
          key={member.userId}
          coordinate={member.location}
          title={member.name}
        />
      ))}
    </MapView>
  );
  ```

---

## 💬 Week 7-8: チャット・通知機能

### Week 7: リアルタイムチャット

#### バックエンド
- [x] **Day 1-3**: チャットメッセージAPI
  ```python
  @app.post("/api/v1/events/{event_id}/messages")
  async def send_message()

  @app.get("/api/v1/events/{event_id}/messages")
  async def get_messages()
  ```

- [x] **Day 4-7**: Firestore チャット同期
  ```python
  # リアルタイムメッセージ配信
  async def broadcast_message(event_id, message_data):
      doc_ref = firestore.collection('events').document(event_id)
      await doc_ref.collection('messages').add(message_data)
  ```

#### フロントエンド
- [x] **Day 1-4**: チャット画面UI
  ```typescript
  // チャット画面
  const ChatScreen = () => (
    <GiftedChat
      messages={messages}
      onSend={onSend}
      user={{ _id: currentUserId }}
    />
  );
  ```

- [x] **Day 5-7**: リアルタイムメッセージ
  ```typescript
  // Firestore メッセージリスナー
  useEffect(() => {
    const unsubscribe = firestore()
      .collection('events')
      .doc(eventId)
      .collection('messages')
      .orderBy('createdAt', 'desc')
      .onSnapshot(updateMessages);

    return unsubscribe;
  }, [eventId]);
  ```

### Week 8: プッシュ通知

#### バックエンド
- [x] **Day 1-3**: Firebase Cloud Messaging 設定
  ```python
  # FCM 通知送信
  async def send_push_notification(user_tokens, title, body, data):
      message = messaging.MulticastMessage(
          tokens=user_tokens,
          notification=messaging.Notification(title=title, body=body),
          data=data
      )
      response = messaging.send_multicast(message)
  ```

- [x] **Day 4-5**: 通知トリガー実装
  ```python
  # ステータス変更時の通知
  async def notify_status_change(event_id, user_id, new_status):
      if new_status in ['ARRIVED', 'DELAYED']:
          await send_status_notification(event_id, user_id, new_status)
  ```

- [x] **Day 6-7**: Cloud Functions バックグラウンド処理
  ```python
  # 定期実行される通知処理
  @functions_framework.cloud_event
  def scheduled_notifications(cloud_event):
      # イベント1時間前の通知
  ```

#### フロントエンド
- [x] **Day 1-4**: FCM統合・権限要求
  ```typescript
  // プッシュ通知権限
  const requestNotificationPermission = async () => {
    const authStatus = await messaging().requestPermission();
    return authStatus === messaging.AuthorizationStatus.AUTHORIZED;
  };
  ```

- [x] **Day 5-7**: 通知ハンドリング・UI
  ```typescript
  // 通知受信処理
  useEffect(() => {
    const unsubscribe = messaging().onMessage(async remoteMessage => {
      showLocalNotification(remoteMessage);
    });

    return unsubscribe;
  }, []);
  ```

---

## 🧪 Week 9-10: テスト・品質保証

### Week 9: 自動テスト実装

#### バックエンド テスト
- [x] **Day 1-3**: 単体テスト（pytest）
  ```python
  # ステータス更新API テスト
  def test_update_status_success():
      response = client.post('/api/v1/events/test-event/status',
                           json={'status_type': 'ON_TRAIN'})
      assert response.status_code == 200
  ```

- [x] **Day 4-5**: 統合テスト
  ```python
  # データベース統合テスト
  async def test_status_firestore_sync():
      await update_user_status(event_id, user_id, status_data)
      firestore_data = await get_firestore_status(event_id, user_id)
      assert firestore_data['status_type'] == status_data['status_type']
  ```

- [x] **Day 6-7**: 負荷テスト（Locust）
  ```python
  class BondPointUser(HttpUser):
      @task
      def update_status(self):
          self.client.post('/api/v1/events/test/status',
                          json={'status_type': 'ON_TRAIN'})
  ```

#### フロントエンド テスト
- [x] **Day 1-4**: 単体テスト（Jest + Testing Library）
  ```typescript
  // ステータス選択コンポーネントテスト
  test('ステータス選択時にコールバックが呼ばれる', async () => {
    const onStatusChange = jest.fn();
    render(<StatusSelector onStatusChange={onStatusChange} />);

    fireEvent.press(screen.getByText('🚃 電車乗車中'));

    await waitFor(() => {
      expect(onStatusChange).toHaveBeenCalledWith({
        status_type: 'ON_TRAIN'
      });
    });
  });
  ```

- [x] **Day 5-7**: E2Eテスト（Detox）
  ```typescript
  describe('ステータス更新フロー', () => {
    it('ログイン→ステータス更新→同期確認', async () => {
      await element(by.id('login-button')).tap();
      await element(by.id('status-ON_TRAIN')).tap();
      await waitFor(element(by.text('🚃 電車乗車中'))).toBeVisible();
    });
  });
  ```

### Week 10: CI/CD・品質管理

#### CI/CD パイプライン
- [x] **Day 1-3**: GitHub Actions 設定
  ```yaml
  # .github/workflows/ci.yml
  name: CI/CD Pipeline
  on: [push, pull_request]

  jobs:
    test:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v4
        - name: Run tests
          run: pytest --cov=app
  ```

- [x] **Day 4-5**: Cloud Build デプロイメント
  ```yaml
  # cloudbuild.yaml
  steps:
    - name: 'gcr.io/cloud-builders/docker'
      args: ['build', '-t', 'gcr.io/$PROJECT_ID/bondpoint-api', '.']

    - name: 'gcr.io/cloud-builders/gcloud'
      args: ['run', 'deploy', 'bondpoint-api', '--image', 'gcr.io/$PROJECT_ID/bondpoint-api']
  ```

- [x] **Day 6-7**: 品質ゲート設定
  ```yaml
  # 品質基準
  code_coverage: ">= 80%"
  security_vulnerabilities: "0 high"
  performance_budget: "< 2s response time"
  ```

#### 監視・ロギング
- [x] **Day 1-3**: Cloud Monitoring 設定
  ```python
  # カスタムメトリクス
  from google.cloud import monitoring_v3

  def record_status_update_metric(status_type):
      client = monitoring_v3.MetricServiceClient()
      # メトリクス記録
  ```

- [x] **Day 4-7**: 構造化ログ実装
  ```python
  # 構造化ログ
  logger.info("Status updated", extra={
      "user_id": user_id,
      "event_id": event_id,
      "old_status": old_status,
      "new_status": new_status
  })
  ```

---

## 🚀 Week 11-12: リリース準備・最適化

### Week 11: パフォーマンス最適化

#### バックエンド最適化
- [x] **Day 1-3**: データベースクエリ最適化
  ```python
  # インデックス追加
  CREATE INDEX CONCURRENTLY idx_user_statuses_event_updated
  ON user_statuses(event_id, updated_at);

  # クエリ最適化
  async def get_event_statuses_optimized(event_id):
      return await db.execute(
          select(UserStatus)
          .where(UserStatus.event_id == event_id)
          .options(joinedload(UserStatus.user))
      )
  ```

- [x] **Day 4-5**: Cloud Run 設定最適化
  ```yaml
  # Cloud Run 最適化設定
  metadata:
    annotations:
      run.googleapis.com/cpu-throttling: "false"
      run.googleapis.com/execution-environment: gen2
  spec:
    containerConcurrency: 80
    timeoutSeconds: 300
  ```

- [x] **Day 6-7**: キャッシュ戦略実装
  ```python
  # Redis キャッシュ
  @cached(ttl=300)  # 5分間キャッシュ
  async def get_user_profile(user_id: str):
      return await db.get_user(user_id)
  ```

#### フロントエンド最適化
- [x] **Day 1-4**: React Native パフォーマンス調整
  ```typescript
  // メモ化によるレンダリング最適化
  const StatusCard = React.memo(({ status, user }) => (
    <View>
      <Text>{user.name}: {status.display}</Text>
    </View>
  ));

  // FlatList最適化
  const StatusList = () => (
    <FlatList
      data={statuses}
      keyExtractor={item => item.userId}
      renderItem={({ item }) => <StatusCard {...item} />}
      removeClippedSubviews
      maxToRenderPerBatch={10}
      windowSize={10}
    />
  );
  ```

- [x] **Day 5-7**: バンドルサイズ最適化
  ```bash
  # Metro bundler 最適化
  npx react-native bundle --platform android --dev false --entry-file index.js --bundle-output android/app/src/main/assets/index.android.bundle

  # 未使用コード削除
  npx react-native-clean-project
  ```

### Week 12: リリース準備・ユーザー受け入れテスト

#### ベータテスト
- [x] **Day 1-2**: TestFlight / Play Console ベータ配信
  ```bash
  # iOS ベータ配信
  cd ios && xcodebuild -workspace BondPointApp.xcworkspace -scheme BondPointApp archive

  # Android ベータ配信
  cd android && ./gradlew bundleRelease
  ```

- [x] **Day 3-4**: ユーザーフィードバック収集・分析
  ```typescript
  // アプリ内フィードバック機能
  const FeedbackModal = () => (
    <Modal>
      <TextInput placeholder="改善点をお聞かせください" />
      <Button title="送信" onPress={submitFeedback} />
    </Modal>
  );
  ```

#### 本番環境準備
- [x] **Day 5-6**: 本番環境構築・設定
  ```bash
  # 本番環境デプロイ
  gcloud run deploy bondpoint-api-prod \
    --image gcr.io/bondpoint-prod/bondpoint-api:latest \
    --region asia-northeast1 \
    --min-instances 1 \
    --max-instances 100
  ```

- [x] **Day 7**: ストア申請・最終確認
  ```
  ✅ App Store Connect 申請
  ✅ Google Play Console 申請
  ✅ プライバシーポリシー公開
  ✅ 利用規約公開
  ✅ 監視・アラート設定確認
  ✅ バックアップ・復旧手順確認
  ```

---

## 📊 進捗管理・品質指標

### 週次マイルストーン

| Week | マイルストーン | 成功基準 | 品質ゲート |
|------|-------------|----------|------------|
| **1-2** | 基盤構築完了 | 認証フロー動作 | セキュリティテスト通過 |
| **3-4** | 基本機能完了 | CRUD操作完全動作 | 単体テスト80%カバレッジ |
| **5-6** | ステータス機能完了 | リアルタイム同期 < 2秒 | E2Eテスト主要フロー通過 |
| **7-8** | 通信機能完了 | プッシュ通知配信成功 | 統合テスト全通過 |
| **9-10** | 品質保証完了 | 全テスト自動化 | 負荷テスト1000user/sec |
| **11-12** | リリース準備完了 | ストア申請済み | セキュリティ監査通過 |

### 学習進捗（React Native初心者向け）

#### Week 1-2: 基礎学習
```typescript
// 学習目標
✅ React Native 基本概念理解
✅ TypeScript基本文法習得
✅ ナビゲーション実装
✅ 基本コンポーネント使用
```

#### Week 3-4: API連携
```typescript
// 学習目標
✅ Axios での HTTP通信
✅ async/await パターン
✅ Error handling
✅ データ状態管理（useState, useEffect）
```

#### Week 5-6: 高度な機能
```typescript
// 学習目標
✅ Firestore リアルタイムリスナー
✅ 位置情報取得・権限管理
✅ プッシュ通知実装
✅ パフォーマンス最適化基礎
```

#### Week 7-8: 実用機能
```typescript
// 学習目標
✅ 複雑なUI コンポーネント
✅ アニメーション基礎
✅ デバイス機能活用
✅ オフライン対応
```

#### Week 9-12: 品質・リリース
```typescript
// 学習目標
✅ テスト自動化（Jest, Detox）
✅ デバッグ・プロファイリング
✅ ストア申請プロセス
✅ 本番運用の考慮事項
```

### リスク管理

#### 技術リスク対策

| リスク | 発生確率 | 影響度 | 対策 |
|--------|----------|--------|------|
| **React Native学習遅延** | 中 | 高 | 週次レビュー、ペアプロ、簡単なUIから開始 |
| **Firestore同期問題** | 低 | 高 | 早期プロトタイプ、フォールバック実装 |
| **パフォーマンス問題** | 中 | 中 | 週次負荷テスト、段階的最適化 |
| **審査却下** | 低 | 高 | 事前ガイドライン確認、ベータテスト |

#### 進捗遅延時の対応

```
遅延発生
    │
    ├── 1週間以内の遅延
    │   ├── 土日作業時間追加
    │   └── 機能スコープ調整
    │
    ├── 2週間以上の遅延
    │   ├── フェーズ2機能の一時除外
    │   └── 外部リソース投入検討
    │
    └── 重大な遅延
        ├── MVP範囲の見直し
        └── リリース時期の調整
```

---

**Next**: [[12-コストとスケーリング]] - 費用見積もりと成長戦略